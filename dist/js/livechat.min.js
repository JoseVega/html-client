!function($,a,b,c){a||(a={},$?$[c]=a:b[c]=a);var d,e,f,g={},h={},i=/[[\]{}()*+?.\\|^$\-,&#\s]/g;f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function j(a){return String(a).replace(/[&<>"'\/]/g,function(a){return f[a]})}a.define=function(a){var b,c,f,k,l=[];for(b in a){f=a[b].codes;for(c in f)k=f[c],g[k]=b,g[j(k)]=b,0==c&&(h[k]=b)}for(k in g)l.push("("+k.replace(i,"\\$&")+")");e=new RegExp(l.join("|"),"g"),d=a},a.replace=function(b,c){return b.replace(e,function(b){var e=g[b];return(c||a.tpl)(e,b,d[e].title)})},a.toString=function(b){var c,e,f="";for(c in h)e=h[c],f+=(b||a.tpl)(e,c,d[e].title);return f},a.tpl=function(a,b,c){return'<span class="emoticon emoticon-'+a+'" title="'+c+'">'+b+"</span>"}}("undefined"!=typeof jQuery?jQuery:null,"undefined"!=typeof exports?exports:null,window,"emoticons");
var liveChat={widgetsKeys:["contacts_list","chat_box","floating_chat"],filesNumCB:[],settings:{},pages:[],scrollsHeightBefore:[],numOfOpenedBoxes:0,maxLeft:100,searchMax:0,searchNum:1,filesNum:0,page:0,scrollHeightBefore:0,lastSender:0,lastTime:0,lastSenderBox:[],lastTimeBox:[],now:null,strDateTime:null,yearNow:null,monthNow:null,dateNow:null,hoursNow:null,minutesNow:null,init:function(a){var b={socketServerUrl:"",siteId:"",clientUrl:"",backendUrl:"",current_user_id:0,current_user_avatar:"",current_user_display_name:"",current_user_username:"",floatingChatBoxWidth:245,texts:{fileBeingUploaded:"The file is uploading...",contactsMobileDropdownTitle:"Contacts",noContactsFound:"Users not found",chattingWith:"Chat with {{display_name}}",writeMessageHere:"Write your message here",searchContacts:"Search contacts",searchMessagesInConversation:"Search in conversation",userIsWriting:"{{display_name}} is writing...",tooManyFloatingBoxesOpened:"You have too many chats opened, please close some to be able to open new ones.",hoursAgo:"{{unit}} hours ago",hourAgo:"{{unit}} hour ago",minutesAgo:"{{unit}} minutes ago",minuteAgo:"{{unit}} minute ago",daysAgo:"{{unit}} days ago",monthsAgo:"{{unit}} months ago",yesterday:"Yesterday",today:"Today",now:"Now",nonExistentContacts:"Your contacts list is empty."},defaultAvatarUrl:"",env:"prod",avFiles:[".doc",".dot",".docx",".dotx",".xls",".xlsx",".xlsm",".ppt",".pot",".pps",".pptx",".pptm",".potx",".potm",".pub",".rar",".zip",".7zip",".html",".css",".js",".json",".gz",".tz",".7z",".tar",".jpeg",".jpg",".tiff",".gif",".bmp",".png",".webp",".psd",".psp",".cpt",".svg",".ai",".pdf",".txt",".csv",".php",".mp4",".mp3",".avi",".flv",".wmv",".mov",".rmvb",".mpg",".mpeg",".m4v",".3gp",".wma",".m4a",".mp2",".aac",".htm",".log"]};return b.templates={floating_chat:'<img src="{{clientUrl}}imgs/chatOpen.png" class="chatOpen" id="chatOpen"><div class="vg-chat vg-chat_floating_chat"><div class="contacts-list" data-open="floating_box"></div><input type="text" id="search-chat" class="form-control contacts-search" placeholder="'+b.texts.searchContacts+'"><div class="glyphicon glyphicon-search" id="glyphiconSearch-fixed"></div></div>',required_elements:'<audio id="chatSound" src="{{newMessageSoundUrl}}"></audio> <a class="image-popup-no-margins" style="display: none;"><img id="image-popup" width="0" height="0"></a>',contacts_list:' <h3 class="mobile-contacts-toggle down-triangle">'+b.texts.contactsMobileDropdownTitle+'</h3><div class="vg-chat vg-chat_contacts_list"><input type="text" class="form-control leftSearch contacts-search" placeholder="'+b.texts.searchContacts+'" id="usersSearch"> <span class="glyphicon glyphicon-search" id="searchGlyphicon"></span> <div class="contacts-list" data-open="master_chat"></div> </div>',chat_box:'<div class="vg-chat vg-chat_chat_box"></div>',chat_box_content:'    <b>{{chat_title}}</b>    <input class="rightSearch form-control" id="rightSearch" placeholder="{{text_search_messages}}" type="text">        <span class="glyphicon glyphicon-search" id="glyphiconSearchRight"></span>        <span class="glyphicon glyphicon-arrow-down" id="downArrow"></span>        <span class="glyphicon glyphicon-arrow-up" id="upArrow"></span>        <span class="lastOnline" id="lastOnline{{other_user.user_id}}" title="{{other_user.last_online_full_date}}">{{other_user.last_online_friendly_date}}</span>        <div id="messages{{other_user.user_id}}" class="messageBox">{{messages}}</div>		<div id="indicator{{other_user.user_id}}" class="indicator">{{text_user_is_writing}}</div>		<textarea class="newMessage" id="newMessage" rows="5"></textarea>		<div class="loadingDiv">			<center>{{text_file_being_uploaded}}</center>			<center>				<div class="modal"></div>			</center>		</div>		<button class="btn btn-green send-message-trigger">Enviar</button>		<div class="filesDiv" id="filesDiv"></div>',contacts:'{{#contacts}}<div class="master contact-{{id}}" id="left{{id}}" data-user-id="{{id}}" data-id="{{id}}" data-display_name="{{display_name}}" data-image="{{image}}"><img class="leftImage" src="{{image}}"><div class="grayRound" id="round{{id}}"></div><div class="nameTime"><span class="name">{{display_name}}</span><br><span class="time" id="time{{id}}" title="{{m_time}}">{{friendly_m_time}}</span><div class="newMessagesNum {{show_new_msg_label}}" id="newMessagesNum{{id}}">{{new_messages}}</div></div></div>{{/contacts}}',my_message:'<div class="oneMessage"><div class="myMsgDiv"><span class="mySpanTime" title="{{m_time}}">{{friendly_m_time}}</span><span class="mySpanName">{{user_name}}</span><div class="myText">{{message}}</div></div><img src="{{user_avatar}}" class="myImage"></div>',other_message:'<img src="{{user_avatar}}" class="otherImage"><div class="otherMsgDiv"><span class="otherSpanName">{{user_name}}</span><span class="otherSpanTime" title="{{m_time}}">{{friendly_m_time}}</span><div class="otherText">{{message}}</div></div>'},this.settings=jQuery.extend({},b,a),this.settings.defaultAvatarUrl||(this.settings.defaultAvatarUrl=this.settings.clientUrl+"imgs/default_avatar.png"),this.settings.floatingChatSendButtonUrl||(this.settings.floatingChatSendButtonUrl=this.settings.clientUrl+"imgs/sendbtn.png"),this.settings.newMessageSoundUrl||(this.settings.newMessageSoundUrl=this.settings.clientUrl+"sound/chat_sound.mp3"),this.areRequiredSettingsSet()?(this.loadStylesheet(),this.renderWidgets(),this.cacheElements(),this.clearStorage(),liveChat.helpers.setDateNow(),this.registerReplaceAll(),this.sockets.initIo(),this.findWidget("contacts_list")&&this.initContactsList(!0),this.findWidget("chat_box")&&this.initMasterChat(),this.bindEvents(),this.initEmoticons(),liveChat.api.displayNewMessagesNotification(),this.initImagePopup(),void this.updateMessagesTimesFloatingChat()):!1},initMasterChat:function(){if(liveChat.api.isOpenedBoxSet()){var a=liveChat.api.getOpenedBoxData();liveChat.api.renderMasterChat(a)}},removeLastDirectoryPartOf:function(a){var b=a.split("/");return b.pop(),b.join("/")},loadStylesheet:function(){if($("link#livechat-css").length)return!0;if("dev"===this.settings.env){var a=this.settings.clientUrl.lastIndexOf("/")===this.settings.clientUrl.length-1?this.settings.clientUrl.substring(0,this.settings.clientUrl.lastIndexOf("/")):this.settings.clientUrl,b=this.removeLastDirectoryPartOf(a);$("head").append('<link rel="stylesheet" href="'+b+'/vendor/magnific-popup/dist/magnific-popup.css"/><link rel="stylesheet" href="'+this.settings.clientUrl+'css/bootstrap-glyphicons.css"/><link rel="stylesheet" href="'+this.settings.clientUrl+'css/emotions.css"/><link rel="stylesheet" id="livechat-css" href="'+this.settings.clientUrl+'css/chat.css"/>')}else $("head").append('<link rel="stylesheet" href="'+this.settings.clientUrl+'vendor/libraries.min.css"/><link rel="stylesheet" id="livechat-css" href="'+this.settings.clientUrl+'css/livechat.min.css"/>')},areRequiredSettingsSet:function(){return this.settings.current_user_id&&this.settings.current_user_display_name&&this.settings.current_user_username&&this.settings.socketServerUrl&&this.settings.clientUrl&&this.settings.backendUrl?!0:!1},renderWidgets:function(){$widgetsHolders=$(".vg-chat-widget-holder"),$widgetsHolders.length&&(jQuery("body").hasClass("vg-live-chat-wrapper")||jQuery("body").addClass("vg-live-chat-wrapper"),$widgetsHolders.each(function(){$widget=jQuery(this);var a='<div class="vg-chat-widget-wrapper">'+liveChat.settings.templates[$widget.data("widget")]+"</div>";Mustache.parse(a);var b=Mustache.render(a,liveChat.settings);$widget.replaceWith(b)}),jQuery("body").trigger("liveChat.widgetsRendered"))},openPopUp:function(a){void 0!==jQuery.fn.magnificPopup&&($(".image-popup-no-margins").attr("href",$(a).attr("src")),$("#image-popup").attr("src",$(a).attr("src")),$(".image-popup-no-margins").magnificPopup("open"))},updateMessagesTimesFloatingChat:function(){setInterval(function(){liveChat.helpers.setDateNow();var a=$(".timeChatBox"),b=$(".timeChatBoxO");if(a.length)for(var c=0;c<a.length;c++)$(a[c]).empty().html(liveChat.helpers.findDifBig(a[c].last_msg_time," "));if(b.length)for(var c=0;c<b.length;c++)$(b[c]).empty().html(liveChat.helpers.findDifBig(b[c].last_msg_time," "))},6e4)},bindEvents:function(){this.$body.on("keyup",".contacts-search",this.initUsersSearch),this.$body.on("click",".open-image-lightbox",function(a){a.preventDefault(),liveChat.openPopUp(jQuery(this).find("img"))}),liveChat.sockets.on("write"+liveChat.settings.current_user_id,this.userStartedWriting.bind(this)),liveChat.sockets.on("stopWrite"+liveChat.settings.current_user_id,this.userStoppedWriting.bind(this)),liveChat.sockets.on("dis",this.userWasDisconnected.bind(this)),liveChat.sockets.on("newCon",this.newUserConnected.bind(this)),liveChat.sockets.on("acceptCon"+liveChat.settings.current_user_id,this.acceptedConnection.bind(this)),liveChat.sockets.on(liveChat.settings.current_user_id,this.messageReceived.bind(this)),this.$body.on("click","#contactList",this.floatingChatToggle),this.$body.on("click","#chatOpen",this.floatingChatBarToggle),this.$body.on("click",".mobile-contacts-toggle",function(a){a.preventDefault();var b=jQuery(this),c=b.next(".vg-chat_contacts_list");jQuery(c).slideToggle(),jQuery(b).hasClass("up-triangle")?jQuery(b).removeClass("up-triangle").addClass("down-triangle"):jQuery(b).removeClass("down-triangle").addClass("up-triangle")}),$(window).on("beforeunload",liveChat.api.updateLastOnline),$(document).ready(function(){setInterval(function(){liveChat.api.data.updateLastOnline(),liveChat.updateLastOnline()},3e5)}),$(window).on("focus",function(){this.setActiveStatus(!0)}.bind(this)),$(window).on("blur",function(){this.setActiveStatus(!1)}.bind(this))},setActiveStatus:function(a){this.isActive=a},floatingChatBarToggle:function(){liveChat.$floatingChatContainer.toggle(),"0px"===$(this).css("right")?($(this).css("right","204px"),liveChat.maxLeft=85,liveChat.api.changeChatBoxPosition()):($(this).css("right","0"),liveChat.maxLeft=100,liveChat.api.changeChatBoxPosition())},floatingChatToggle:function(){this.$floatingChatContainer.show(),$("#contactList").hide()},initFloatingChat:function(){liveChat.helpers.setDateNow(),inicialize_master()},initImagePopup:function(){$(".image-popup-no-margins").magnificPopup({type:"image",closeOnContentClick:!0,closeBtnInside:!1,fixedContentPos:!0,mainClass:"mfp-no-margins mfp-with-zoom",image:{verticalFit:!0},zoom:{enabled:!0,duration:300}})},messageReceived:function(a){if(liveChat.helpers.setDateNow(),liveChat.settings.current_user_id===a.from)return!0;if($("#chatSound").get(0).play(),void 0!==$("#messages"+a.from).html()){var b=$("#messages"+a.from),c=b[0].scrollHeight,d=parseInt($(b[0]).scrollTop())+parseInt($(b[0]).height())+100;liveChat.api.renderMessage($("#messages"+a.from),a.display_name,a.image_url,a.msg,this.strDateTime,a.from,!1,!0),d>c&&liveChat.helpers.scrollToBottom($("#messages"+a.from)),$.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=read_messages",data:{id:a.from},error:function(a,b,c){},success:function(a){}})}if(void 0===$("#messages"+a.from).html()&&void 0!==$("#chatBox"+a.from).html()&&"none"===$("#chatBox"+a.from).find(".chatBoxMessages").css("display")){$.titleAlert("New message");var e=$("#newMessagesNum"+a.from);if(void 0!==e){var f=$("#newMessagesNum"+a.from).html();f++,$("#newMessagesNum"+a.from).empty().html(f).show()}var e=$("#newMessagesNum-chat"+a.from);if(void 0!==e){var f=$("#newMessagesNum-chat"+a.from).html();f++,$("#newMessagesNum-chat"+a.from).empty().html(f).css("visibility","visible")}$("#chatBox"+a.from).find(".firstLineChatBox").addClass("lineColorNewMessage")}if(void 0!==$("#chatBox"+a.from).html()){var b=$("#chatBox"+a.from).find(".chatBoxMessages"),c=b[0].scrollHeight,d=parseInt($(b[0]).scrollTop())+parseInt($(b[0]).height())+100;if(liveChat.api.renderMessage(b[0],a.display_name,a.image_url,a.msg,this.strDateTime,a.from,!0,!0),d>c)for(var g=0;4>g;g++)setTimeout(liveChat.api.scrollToBottom,200*g,b[0]);"none"!==$("#chatBox"+a.from).find(".chatBoxMessages").css("display")&&$.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=read_messages",data:{id:a.from},error:function(a,b,c){},success:function(a){}})}if(void 0===$("#messages"+a.from).html()&&void 0===$("#chatBox"+a.from).html()&&liveChat.api.renderFloatingBox(a.from,a.display_name,a.image_url),void 0!==$(".vg-chat_contacts_list").html()){$("#left"+a.from).parent().prepend($("#left"+a.from)),$("#time"+a.from).empty().append("now");var h=new Date,i=[[h.getFullYear(),liveChat.helpers.AddZero(h.getMonth()+1),liveChat.helpers.AddZero(h.getDate())].join("-"),[liveChat.helpers.AddZero(h.getHours()),liveChat.helpers.AddZero(h.getMinutes()),liveChat.helpers.AddZero(h.getSeconds())].join(":")].join(" "),j=$("#time"+a.from);void 0!==j[0]&&(j[0].last_msg_time=i)}this.isActive||$.titleAlert("New message")},acceptedConnection:function(a){$("#round"+a).removeClass("grayRound").addClass("greenRound"),$("#lastOnline"+a).css("visibility","hidden")},initEmoticons:function(){var a={smile:{title:"Smile",codes:[":)",":=)",":-)"]},"sad-smile":{title:"Sad Smile",codes:[":(",":=(",":-("]},"big-smile":{title:"Big Smile",codes:[":D",":=D",":-D",":d",":=d",":-d"]}};$.emoticons.define(a)},newUserConnected:function(a){a!==liveChat.settings.current_user_id&&liveChat.api.acceptNewUserConnection(a)},userStoppedWriting:function(a){var b=$("#indicatorChatBox"+a);if(void 0!==b[0]){$(b[0]).hide();var c=$("#messages"+a);if(void 0!==c[0]){var d=parseInt($(c[0]).css("height"))+18;$(c[0]).css("height",d)}}var b=$("#indicator"+a);void 0!==b[0]&&$(b[0]).hide()},userStartedWriting:function(a){var b=$("#indicator"+a);if(void 0!==b[0]){$(b[0]).show();var c=$("#messages"+a);if(void 0!==c[0]){var d=parseInt($(c[0]).css("height"))-18;$(c[0]).css("height",d)}}var b=$("#indicatorChatBox"+a);if(void 0!==b[0]){var e=$(b[0]).parent().find("textarea");"none"!==$(e[0]).css("display")&&$(b[0]).show()}},userWasDisconnected:function(a){$("#round"+a).removeClass("greenRound").addClass("grayRound"),$("#roundCB"+a).removeClass("greenRound").addClass("grayRound"),liveChat.helpers.setDateNow();var b=$("#lastOnline"+a);void 0!==b[0]&&($(b[0]).css("visibility","visible").empty().append(liveChat.helpers.findDifLastOnline(this.strDateTime)).attr("title",this.strDateTime.slice(0,4)+"/"+this.strDateTime.slice(5,7)+"/"+this.strDateTime.slice(8,10)+" "+this.strDateTime.slice(11,16)),b[0].time=this.strDateTime)},clearStorage:function(){(""===liveChat.helpers.getCookie("window")||" "===liveChat.helpers.getCookie("window"))&&localStorage.clear()},cacheElements:function(){this.$body=jQuery("body"),this.$widgets=this.$body.find(".vg-chat"),this.$floatingChatContainer=this.$body.find(".vg-chat_floating_chat"),this.$masterChatContainer=this.$body.find(".vg-chat_chat_box")},findWidget:function(a){return this.$body.find(".vg-chat_"+a).length},delay:function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),initUsersSearch:function(){var a=$(this).val();liveChat.delay(function(){a&&a.trim()?(liveChat.helpers.setDateNow(),a.length>1?liveChat.api.searchContacts(a,"full",!1):liveChat.api.searchContacts(a,"first_letter",!1)):(liveChat.helpers.setDateNow(),liveChat.initContactsList())},800)},setOpenedUser:function(a){liveChat.api.isOpenedBoxSet()||liveChat.api.renderMessages(a)},renderNonExistentContactsMsg:function(){liveChat.findWidget("chat_box")&&liveChat.$masterChatContainer.empty().append('<p class="vg-chat-non-existent-contacts-message">'+liveChat.settings.texts.nonExistentContacts+"</p>"),liveChat.$body.find(".vg-chat_contacts_list").length&&liveChat.$body.find(".vg-chat_contacts_list").append('<p class="vg-chat-non-existent-contacts-message">'+liveChat.settings.texts.nonExistentContacts+"</p>")},initContactsList:function(a){a||(a=!1),liveChat.api.data.getContacts().done(function(b){return liveChat.contactsList=b,!b||$.isEmptyObject(b)?(liveChat.renderNonExistentContactsMsg(),!0):($(".contacts-list").empty(),liveChat.api.renderContacts(this.contactsList,liveChat.$body.find(".contacts-list"),a),liveChat.$body.find(".vg-chat_contacts_list").css("max-height",jQuery(window).height()),void liveChat.sockets.emit("con",liveChat.settings.current_user_id))}.bind(this))},updateLastOnline:function(){liveChat.helpers.setDateNow(),liveChat.helpers.setDateNow();var a=$(".vg-chat_contacts_list").find(".master");if(a.length)for(var b=0;b<a.length;b++){var c=$(a[0]).find(".time");c&&c[0].last_msg_time&&$(c[0]).empty().html(liveChat.helpers.findDif(c[0].last_msg_time))}var d=$(".lastOnline");d.length&&void 0!==d[0]&&$(d[0]).empty().append(liveChat.helpers.findDifLastOnline(d[0].time));var c=$(".mySpanTime");if(c.length)for(var b=0;b<c.length;b++)$(c[b]).empty().html(liveChat.helpers.findDifBig(c[b].time));var c=$(".otherSpanTime");if(c.length)for(var b=0;b<c.length;b++)$(c[b]).empty().html(liveChat.helpers.findDifBig(c[b].time))},scrolltoDown:function(){$(window).ready(function(){setTimeout(function(){liveChat.helpers.scrollToBottom()},200)})},registerReplaceAll:function(){String.prototype.replaceAll=function(a,b,c){return this.replace(new RegExp(a.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),c?"gi":"g"),"string"==typeof b?b.replace(/\$/g,"$$$$"):b)}},handleFileSelect:function(a,b){a.stopPropagation(),a.preventDefault(),a=a.originalEvent;for(var c,d=a.dataTransfer.files,e=0;c=d[e];e++){if(b){if($(a.target).prop("disabled"))break;liveChat.filesNumCB[a.target.to]++}var f=Math.floor(Date.now()/1e3)+""+liveChat.settings.current_user_id+"_"+e,g=c.name.split(".");if(-1!=liveChat.settings.avFiles.indexOf("."+g[g.length-1])){var h='<span class="fileName" id="{{timestamp}}"><div class="fileLoad"><div class="sk-fading-circle">        <div class="sk-circle1 sk-circle"></div>        <div class="sk-circle2 sk-circle"></div>        <div class="sk-circle3 sk-circle"></div>        <div class="sk-circle4 sk-circle"></div>        <div class="sk-circle5 sk-circle"></div>        <div class="sk-circle6 sk-circle"></div>        <div class="sk-circle7 sk-circle"></div>        <div class="sk-circle8 sk-circle"></div>       <div class="sk-circle9 sk-circle"></div>       <div class="sk-circle10 sk-circle"></div>        <div class="sk-circle11 sk-circle"></div>        <div class="sk-circle12 sk-circle"></div>    </div></div></span>',i={timestamp:f};Mustache.parse(h);var j=Mustache.render(h,i);if(b){var k=$(a.target).parent().find(".filesNames");k.append(j);var l=k.find(".fileName").first()}else{var k=$("#filesDiv");k.append(j);var l=k.find(".fileName").first()}l.newName=f,l.extension=g[g.length-1];var m=new FormData;m.append("label",c.name),m.append("to_user",$(a.target).data("to-user")),m.append("newName",f),m.append("file",c),$.ajax({url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=upload",type:"POST",data:m,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(a){var c=a.slice(1,a.length-2).split(","),d=c[0].replaceAll('"',""),e=c[1].replaceAll('"',""),f=c[2].replaceAll('"',""),g=c[3].replaceAll('"',""),h="";"png"===e||"jpg"===e||"jpeg"===e||"gif"===e||"bmp"===e?(h='[linked_file="'+d+'" type="image" filename="'+g+'"]',liveChat.api.sendMessage(h,f)):(h='[linked_file="'+d+'" type="file" filename="'+g+'"]',b?liveChat.api.sendMessage(h,f,$("#"+d).parent()):liveChat.api.sendMessage(h,f)),$("#"+d).remove()})}}},handleDragOver:function(a){a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="copy"},textareaHandler:function(a,b,c,d){d||(d=!1);var e=c.find("textarea");e.data("to-user",a).focusin(function(){data={my:b,to:a},liveChat.sockets.emit("write",data)}).focusout(function(){data={my:b,to:a},liveChat.sockets.emit("stopWrite",data)}).keydown(function(a){13!=a.keyCode||a.shiftKey||a.preventDefault()}).keyup(function(a){if(window.event)var b=window.event.keyCode;else var b=a.keyCode||a.which;a.shiftKey||13!=b||liveChat.api.startSendingMessage(c,d)}.bind(d)).on("dragover",liveChat.handleDragOver).on("drop",function(a){liveChat.handleFileSelect(a,d)})}};
liveChat.helpers={setCookie:function(a,b,c){var d=new Date;d.setTime(d.getTime()+60*c*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e},getCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""},AddZero:function(a){return a>=0&&10>a?"0"+a:a+""},findDif:function(a){if(a.slice(0,4)<liveChat.yearNow&&liveChat.monthNow-parseInt(a.slice(5,7))+12>1||a.slice(0,4)==liveChat.yearNow&&liveChat.monthNow-parseInt(a.slice(5,7))>0&&liveChat.dateNow>parseInt(a.slice(8,10)))return this.numberToMonth(parseInt(a.slice(5,7)))+" "+a.slice(8,10);if(liveChat.monthNow-parseInt(a.slice(5,7))>0&&liveChat.dateNow-parseInt(a.slice(8,10))+this.getMonthDays(a.slice(0,4),parseInt(a.slice(5,7)))>7||liveChat.monthNow-parseInt(a.slice(5,7))==0&&liveChat.dateNow-parseInt(a.slice(8,10))>7)return this.numberToMonth(parseInt(a.slice(5,7)))+" "+a.slice(8,10);var b=0;if(b=liveChat.monthNow-parseInt(a.slice(5,7))>0?liveChat.dateNow-parseInt(a.slice(8,10))+this.getMonthDays(a.slice(0,4),parseInt(a.slice(5,7))):liveChat.dateNow-parseInt(a.slice(8,10)),b>1){var c=liveChat.settings.texts.daysAgo,d={unit:b};return Mustache.parse(c),Mustache.render(c,d)}var e=24*b+(liveChat.hoursNow-parseInt(a.slice(11,13)));if(e>23)return liveChat.settings.texts.yesterday;if(e>1){var c=liveChat.settings.texts.hoursAgo,d={unit:e};return Mustache.parse(c),Mustache.render(c,d)}var f=60*e+(liveChat.minutesNow-parseInt(a.slice(14,16)));if(f>59){var c=liveChat.settings.texts.hourAgo,d={unit:e};return Mustache.parse(c),Mustache.render(c,d)}if(f>1){var c=liveChat.settings.texts.minutesAgo,d={unit:f};return Mustache.parse(c),Mustache.render(c,d)}if(f>0){var c=liveChat.settings.texts.minuteAgo,d={unit:1};return Mustache.parse(c),Mustache.render(c,d)}return liveChat.settings.texts.now},findDifLastOnline:function(a){if(void 0===a)return"";if(a.slice(0,4)<liveChat.yearNow&&liveChat.monthNow-parseInt(a.slice(5,7))+12>1||a.slice(0,4)==liveChat.yearNow&&liveChat.monthNow-parseInt(a.slice(5,7))>0&&liveChat.dateNow>parseInt(a.slice(8,10)))return this.numberToMonth(parseInt(a.slice(5,7)))+" "+a.slice(8,10);if(liveChat.monthNow-parseInt(a.slice(5,7))>0&&liveChat.dateNow-parseInt(a.slice(8,10))+this.getMonthDays(a.slice(0,4),parseInt(a.slice(5,7)))>7||liveChat.monthNow-parseInt(a.slice(5,7))==0&&liveChat.dateNow-parseInt(a.slice(8,10))>7)return this.numberToMonth(parseInt(a.slice(5,7)))+" "+a.slice(8,10);var b=0;if(b=liveChat.monthNow-parseInt(a.slice(5,7))>0?liveChat.dateNow-parseInt(a.slice(8,10))+this.getMonthDays(a.slice(0,4),parseInt(a.slice(5,7))):liveChat.dateNow-parseInt(a.slice(8,10)),b>1){var c=liveChat.settings.texts.daysAgo,d={unit:b};return Mustache.parse(c),Mustache.render(c,d)}var e=24*b+(liveChat.hoursNow-parseInt(a.slice(11,13)));if(e>23)return liveChat.settings.texts.yesterday;if(e>1){var c=liveChat.settings.texts.hoursAgo,d={unit:e};return Mustache.parse(c),Mustache.render(c,d)}var f=60*e+(liveChat.minutesNow-parseInt(a.slice(14,16)));if(f>59){var c=liveChat.settings.texts.hourAgo,d={unit:e};return Mustache.parse(c),Mustache.render(c,d)}if(f>1){var c=liveChat.settings.texts.minutesAgo,d={unit:f};return Mustache.parse(c),Mustache.render(c,d)}var c=liveChat.settings.texts.minuteAgo,d={unit:1};return Mustache.parse(c),Mustache.render(c,d)},numberToMonth:function(a){switch(a){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec"}},getMonthDays:function(a,b){switch(b){case 1:return 31;case 2:return a%4==0?29:28;case 3:return 31;case 4:return 30;case 5:return 31;case 6:return 30;case 7:return 31;case 8:return 31;case 9:return 30;case 10:return 31;case 11:return 30;case 12:return 31}},findDifBig:function(a){if(!a)return"";if(a.slice(0,4)<liveChat.yearNow&&liveChat.monthNow-parseInt(a.slice(5,7))+12>1||a.slice(0,4)==liveChat.yearNow&&liveChat.monthNow-parseInt(a.slice(5,7))>0&&liveChat.dateNow>parseInt(a.slice(8,10)))return a.slice(0,4)+"/"+a.slice(5,7)+"/"+a.slice(8,10)+" | "+a.slice(11,16);if(liveChat.monthNow-parseInt(a.slice(5,7))>0&&liveChat.dateNow-parseInt(a.slice(8,10))+this.getMonthDays(a.slice(0,4),parseInt(a.slice(5,7)))>7||liveChat.monthNow-parseInt(a.slice(5,7))==0&&liveChat.dateNow-parseInt(a.slice(8,10))>7)return a.slice(0,4)+"/"+a.slice(5,7)+"/"+a.slice(8,10)+" | "+a.slice(11,16);var b=0;if(b=liveChat.monthNow-parseInt(a.slice(5,7))>0?liveChat.dateNow-parseInt(a.slice(8,10))+this.getMonthDays(a.slice(0,4),parseInt(a.slice(5,7))):liveChat.dateNow-parseInt(a.slice(8,10)),b>1)return a.slice(0,4)+"/"+a.slice(5,7)+"/"+a.slice(8,10)+" "+a.slice(11,16);var c=24*b+(liveChat.hoursNow-parseInt(a.slice(11,13)));if(c>23)return"Yesterday";if(c>1)return c+" hours";var d=60*c+(liveChat.minutesNow-parseInt(a.slice(14,16)));return d>59?c+" hour":d>1?d+" mins":d>0?d+" min":"now"},scrollToBottom:function(a){a.length>1&&(a=a.first());for(var b=0;6>b;b++)setTimeout(function(){$(a).scrollTop($(a)[0].scrollHeight)},400*b)},getQueryStringValue:function(a,b){var c=b?b:window.location.href,d=new RegExp("[?&]"+a+"=([^&#]*)","i"),e=d.exec(c);return e?e[1]:null},setDateNow:function(){now=new Date,liveChat.strDateTime=[[now.getFullYear(),liveChat.helpers.AddZero(now.getMonth()+1),liveChat.helpers.AddZero(now.getDate())].join("-"),[liveChat.helpers.AddZero(now.getHours()),liveChat.helpers.AddZero(now.getMinutes()),liveChat.helpers.AddZero(now.getSeconds())].join(":")].join(" "),liveChat.yearNow=now.getFullYear(),liveChat.monthNow=now.getMonth()+1,liveChat.dateNow=now.getDate(),liveChat.hoursNow=now.getHours(),liveChat.minutesNow=now.getMinutes()},waitForUpload:function(a,b,c,d){c?liveChat.filesNumCB[b]>0?setTimeout(liveChat.api.waitForUpload,500,a,b,!0,d):($("#loadingDivChatBox"+b).removeClass("loadingChatBox"),liveChat.api.sendMessage(a,b),$(d).val("").prop("disabled",!1)):liveChat.filesNum>0?setTimeout(liveChat.api.waitForUpload,500,a,b):($(".loading").removeClass("loading"),liveChat.api.sendMessage(a,b),$("#newMessage").val("").prop("disabled",!1))},replaceImageShortcode:function(a){var b="<br><a href='#' class='open-image-lightbox'><img src="+liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=read_image&image=$1 class=messageImage></a><br>",c="<a target='_blank' href='"+liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=download_proxy&file=$1'>$3</a><br>";return a=a.replaceAll("&quot;",'"'),a.replace(/\[linked_file="(.+)" type="(.+)" filename="(.+)"\]/i,a.indexOf('type="image"')<0?c:b)}};
liveChat.sockets={io:!1,initIo:function(){this.io||(this.io=io(liveChat.settings.socketServerUrl+"/"+liveChat.settings.siteId))},sendMessage:function(a,b){liveChat.sockets.emit("sendMessage",{from:liveChat.settings.current_user_id,to:b,msg:a,display_name:liveChat.settings.current_user_display_name,image_url:liveChat.settings.current_user_avatar})},emit:function(a,b){liveChat.sockets.io.emit(a,b)},on:function(a,b){liveChat.sockets.io.on(a,b)}};
liveChat.api={toggleFloatingBoxVisibility:function(a){a.find(".newMessageChatBox").toggle(),a.find(".chatBoxMessages").toggle(),a.find(".sndBtn").toggle()},getContactFromCache:function(a){for(var b=0;b<liveChat.contactsList.length;b++)if(liveChat.contactsList[b].id==a||liveChat.contactsList[b].display_name==a)return liveChat.contactsList[b];return!1},resetFloatingBoxPointers:function(a){liveChat.filesNumCB[a]=0,liveChat.lastSenderBox[a]=0,liveChat.lastTimeBox[a]=0,liveChat.pages[a]=1,liveChat.scrollsHeightBefore[a]=0},noUserFound:function(){var a="<center><b>{{text_no_user_found}}</b></center>";Mustache.parse(a);var b=Mustache.render(a,{text_no_user_found:liveChat.settings.texts.noContactsFound});$(".contacts-list").append(b)},setOpenedBox:function(a){localStorage.setItem("id",a.id),localStorage.setItem("display_name",a.display_name),localStorage.setItem("image",a.image),localStorage.setItem("openedBox",1),liveChat.helpers.setCookie("window",1,10)},getOpenedBoxData:function(){if(!liveChat.api.isOpenedBoxSet())return!1;var a={id:localStorage.getItem("id"),display_name:localStorage.getItem("display_name"),image:localStorage.getItem("image"),openedBox:localStorage.getItem("openedBox")};return a},isOpenedBoxSet:function(){var a=localStorage.getItem("openedBox");return a&&$.trim(a)?!0:!1},renderMessages:function(a,b,c,d){liveChat.helpers.setDateNow(),c.hasClass("jspScrollable")&&(c=c.find(".jspPane")),liveChat.api.data.getMessagesWith(a.id,!1).done(function(e){if(c.length>1&&(c=c.first()),c.parent().find("#spinner"+a.id).remove(),e.length){for(var f=0;f<e.length;f++)e[f].user_sender==a.id?liveChat.api.renderMessage(c,a.display_name,a.image,e[f].message,e[f].m_time,a.id,b,!1):liveChat.api.renderMessage(c,null,null,e[f].message,e[f].m_time,null,b,!1);d&&$(c).scrollTop(c[0].scrollHeight-liveChat.scrollHeightBefore),b?liveChat.pages[a.id]++:liveChat.page++}else $(c).off();liveChat.$body.trigger("liveChat.messagesRendered",[a,e,b,c,d])}.bind(this))},isUserOnline:function(a){return $("#round"+a).length?!$("#round"+a).hasClass("grayRound"):!1},resetNewMessagesCountFromUser:function(a){var b=$("body").find("#newMessagesNum"+a+", #newMessagesNumChatBox"+a);$("body").find("#newMessagesNum"+a).hide(),liveChat.api.stopTittleAlert(),b.length&&b.empty().html(0).css("visibility","hidden"),liveChat.api.data.markAllMessagesAsReadFrom(a).done(function(a){liveChat.api.stopTittleAlert()}),liveChat.$body.trigger("liveChat.newMessagesCountReset",[a])},renderMasterChat:function(a){liveChat.helpers.setDateNow(),liveChat.page=1;var b=liveChat.settings.templates.chat_box_content,c={other_user:{display_name:a.display_name,last_online_full_date:"",last_online_friendly_date:"",user_id:a.id},messages:"",chat_title:Mustache.render(liveChat.settings.texts.chattingWith,{display_name:a.display_name}),text_search_messages:liveChat.settings.texts.searchMessagesInConversation,text_user_is_writing:Mustache.render(liveChat.settings.texts.userIsWriting,{display_name:a.display_name}),text_file_being_uploaded:liveChat.settings.texts.fileBeingUploaded};Mustache.parse(b);var d=Mustache.render(b,c),e=$(".vg-chat_chat_box").first();e.empty().append(d);var f=e.find("#messages"+a.id).first();f.user_id=a.id,f.display_name=a.display_name,f.image=a.image,liveChat.api.renderMessages(a,!1,f),$(f).on("scroll",function(){liveChat.api.initInfiniteScrollOnMainChat(a,f)}),liveChat.api.isUserOnline(a.id)?e.find(".lastOnline").empty().text("now").attr("title",new Date):liveChat.api.data.getUserLastOnline(a.id,function(a){e.find(".lastOnline").empty().text(a.friendly_time).attr("title",a.full_time)}),e.find("#downArrow").click(function(){if(liveChat.searchMax>0&&liveChat.searchNum<liveChat.searchMax){var a=$(".messageBox"),b=$(a[0]).find(".oneMessage");a[0].scrollTop+=parseInt($(b[liveChat.searchNum-1]).height())+15;var c=$(b[liveChat.searchNum-1]).find("div");$(c[1]).removeClass("searchDivYellow");var c=$(b[liveChat.searchNum]).find("div");$(c[1]).addClass("searchDivYellow"),liveChat.searchNum++}}),e.find("#upArrow").first().click(function(){if(liveChat.searchMax>0&&liveChat.searchNum>1){var a=$(".messageBox"),b=$(a[0]).find(".oneMessage");a[0].scrollTop-=parseInt($(b[liveChat.searchNum-2]).height())+15;var c=$(b[liveChat.searchNum-1]).find("div");$(c[1]).removeClass("searchDivYellow");var c=$(b[liveChat.searchNum-2]).find("div");$(c[1]).addClass("searchDivYellow"),liveChat.searchNum--}}),liveChat.api.resetNewMessagesCountFromUser(a.id);var g=e.find("#rightSearch").first();g.user_id=a.id,g.display_name=a.display_name,g.image=a.image,g.on("keyup",function(){var b=$(this).val(),c={id:g.user_id,display_name:g.display_name,image:g.image};liveChat.delay(function(){""==b.trim()?($("#upArrow").hide(),$("#downArrow").hide(),liveChat.helpers.setDateNow(),liveChat.page=1,$(f).empty(),liveChat.api.renderMessages(c,!1,$(f)),$(f).on("scroll",function(){liveChat.api.initInfiniteScrollOnMainChat(a,f)})):($("#upArrow").show(),$("#downArrow").show(),liveChat.helpers.setDateNow(),liveChat.page=1,$(f).empty(),liveChat.api.searchMessages(b,c.id,c.display_name,c.image))},800)}),liveChat.textareaHandler(a.id,liveChat.settings.current_user_id,e,!1);var h=e.find(".send-message-trigger").first();h.to=a.id,$(h).click(function(){liveChat.api.startSendingMessage(e,!1)}),liveChat.api.stopTittleAlert(),liveChat.api.setOpenedBox(a),liveChat.$body.trigger("liveChat.masterChatRendered",[a])},initInfiniteScrollOnMainChat:function(a,b){if(0==$(b).scrollTop()){var c='<div class="spinner" id="spinner'+a.id+'"> <div class="rect1"></div> <div class="rect2"></div> <div class="rect3"></div> <div class="rect4"></div> <div class="rect5"></div> </div>';$(b).prepend(c),liveChat.scrollHeightBefore=b[0].scrollHeight,liveChat.api.renderMessages({id:a.id,display_name:a.display_name,image:a.image},!1,$(b),!0)}},sendMessage:function(a,b){liveChat.sockets.sendMessage(a,b),$(".contact-"+b).each(function(){var a=jQuery(this);a.parent().prepend(a)}),$("#time"+b).empty().html("now");var c=$("#time"+b),d=new Date,e=[[d.getFullYear(),liveChat.helpers.AddZero(d.getMonth()+1),liveChat.helpers.AddZero(d.getDate())].join("-"),[liveChat.helpers.AddZero(d.getHours()),liveChat.helpers.AddZero(d.getMinutes()),liveChat.helpers.AddZero(d.getSeconds())].join(":")].join(" ");c.length&&(c[0].last_msg_time=e),$("#messages"+b).length&&liveChat.api.renderMessage($("#messages"+b),null,null,a,e,null,!1,!0),$("#chatBox"+b).find(".chatBoxMessages").length&&liveChat.api.renderMessage($("#chatBox"+b).find(".chatBoxMessages"),null,null,a,e,null,!0,!0),liveChat.api.data.saveMessage(b,a),liveChat.$body.trigger("liveChat.messageSaved",[b,a])},renderMessage:function(a,b,c,d,e,f,g,h){b||(b=liveChat.settings.current_user_display_name),c||(c=liveChat.settings.current_user_avatar),f||(f=liveChat.settings.current_user_id);var i=f==liveChat.settings.current_user_id?"my":"other",j=g?"."+i+"MessageTextChatBox":"."+i+"MsgDiv",k="."+i+"Text",d=$.emoticons.replace(d),d=liveChat.helpers.replaceImageShortcode(d),l=g?liveChat.lastSenderBox[f]:liveChat.lastSender,m=g?liveChat.lastTimeBox[f]:liveChat.lastTime;if(l==f&&liveChat.lastTime&&e.slice(0,16)===m.slice(0,16)){var n=$(a).find(g?".masterMsgDiv":".oneMessage"),o=$(n[h?n.length-1:0]).find(j),p=g?o[0]:$(o[0]).find(k);h?$(p).append(d+"<br/>"):$(p).prepend(d+"<br/>")}else{if(g?(liveChat.lastSenderBox[f]=f,liveChat.lastTimeBox[f]=e):(liveChat.lastSender=f,liveChat.lastTime=e),g)var q='<div class="masterMsgDiv"><div class="nameTimeChatBox '+i+'nameTimeChatBox"><span class="nameChatBoxO">{{display_name}}</span><span title="{{full_date}}" class="timeChatBoxO">{{friendly_date}}</span></div><div class="'+i+'MessageTextChatBox">{{{message}}}</div></div>';else var r="my"===i?"":'<img src="{{image_url}}" class="'+i+'Image">',s="my"===i?'<img src="{{image_url}}" class="'+i+'Image">':"",q='<div class="oneMessage">'+r+'<div class="'+i+'MsgDiv"><span class="'+i+'SpanName">{{display_name}}</span><span class="'+i+'SpanTime" title="{{friendly_date}}">{{full_date}}</span><div class="'+i+'Text">{{{message}}}</div></div>'+s+"</div>";var t={image_url:c?c:liveChat.settings.defaultAvatarUrl,display_name:b,full_date:e.slice(0,4)+"/"+e.slice(5,7)+"/"+e.slice(8,10)+" | "+e.slice(11,16),friendly_date:liveChat.helpers.findDifBig(e),message:d};Mustache.parse(q);var u=Mustache.render(q,t);h?$(a).append(u):$(a).prepend(u)}$(a).first()[0].scrollTop=$(a).first()[0].scrollHeight},renderContacts:function(a,b,c){var d=liveChat.settings.templates.contacts;Mustache.parse(d),$.each(a,function(b,c){a[b].image=a[b].image?a[b].image:liveChat.settings.defaultAvatarUrl,a[b].friendly_m_time=a[b].m_time?liveChat.helpers.findDif(a[b].m_time):"",a[b].show_new_msg_label=function(){return a[b].new_messages>0?"":"hidden"}});var e=Mustache.render(d,{contacts:a});$(b).html(e),$(b).each(function(){var b=jQuery(this),d=b.data("open");if(!d)return!0;if(c)if("master_chat"===d){var e=$.trim(liveChat.helpers.getQueryStringValue("chat_with"));if(e)var f=liveChat.api.getContactFromCache(e);else var f=a[0];$("#left"+f.id).first().active=!0,liveChat.api.isOpenedBoxSet()||liveChat.api.renderMasterChat(f)}else liveChat.api.openPreviouslyOpenedFloatingBoxes();b.children().each(function(){jQuery(this).click(function(){"master_chat"===d?liveChat.api.renderMasterChat(jQuery(this).data()):(liveChat.api.resetFloatingBoxPointers(jQuery(this).data("id")),liveChat.api.openFloatingBox(jQuery(this).data()))})})}),liveChat.sockets.emit("con",liveChat.settings.current_user_id),liveChat.$body.trigger("liveChat.contactsListRendered",[a,b,c])},openFloatingBox:function(a){var b=liveChat.api.getFloatingBoxPosition(),c=b+2*(liveChat.settings.floatingChatBoxWidth+10);if(c>jQuery(window).width())return alert(liveChat.settings.texts.tooManyFloatingBoxesOpened),!1;var d=a,e=liveChat.$floatingChatContainer.find(".contact-"+d.id);e.find(".newMessagesNum").empty().html(0).css("visibility","hidden");var f=$("#chatBox"+d.user_id);f.length?liveChat.api.isFloatingBoxMinized(f)&&liveChat.api.toggleFloatingBoxVisibility(f):liveChat.api.renderFloatingBox(d.id,d.display_name,d.image)},isFloatingBoxMinimized:function(a){return!a.find(".chatBoxMessages").is("visible")},closeChatBox:function(a){liveChat.numOfOpenedBoxes--,$("#chatBox"+a).remove(),liveChat.api.changeChatBoxPosition();var b=liveChat.helpers.getCookie("chatBoxes"),c=b.split("&**&");if(c.length<2)liveChat.helpers.setCookie("chatBoxes","",1e-5);else{for(var d="",e=0,f=0;f<c.length;f++){var g=c[f].split("&*&");if(parseInt(g[0])!=parseInt(a)){var h=g[0]+"&*&"+g[1]+"&*&"+g[2];0==e?(e=1,d+=h):d+="&**&"+h}}liveChat.helpers.setCookie("chatBoxes",d,3e6)}},getFloatingBoxPosition:function(){return(liveChat.numOfOpenedBoxes-1)*liveChat.settings.floatingChatBoxWidth+10},startSendingMessage:function(a,b){var c=a.find("textarea"),d=$.trim(c.val()),e=b?$.trim(a.find(".filesNames").html()):$.trim(a.find("#filesDiv").html());if(d||e){var d=d.replaceAll("\n","<br>").replaceAll("'","&#39;").replaceAll('"',"&#34;");liveChat.api.sendMessage(d,c.data("toUser")),c.val("")}},renderFloatingBox:function(a,b,c){liveChat.numOfOpenedBoxes++,liveChat.pages[a]=1;var d='<div class="vg-chat-widget-wrapper"><div class="chatBox hidden" id="chatBox{{user_id}}" style="right: {{box_position}}px;"><div class="floating-box-header firstLineChatBox lineColorGray"><div class="newMessagesNum-chatBox" id="newMessagesNumChatBox{{user_id}}"  style="visibility: {{new_messages_count_visibility}};">{{new_messages_count}}</div><div class="chatBoxName">{{display_name}}</div><div class="remove glyphicon glyphicon-remove glyphicon-remove-chatBox"></div><div class="spanLine"></div></div><div class="chatBoxMessages"></div><div id="indicatorChatBox{{user_id}}" class="indicator user-typing-indicator">{{text_user_is_writing}}</div><textarea class="newMessageChatBox" id="newMessageChatBox" rows="2" placeholder="{{text_write_message_here}}"></textarea><img class="sndBtn send-message-trigger" src="{{send_button_url}}"><div class="filesNames"></div><div class="loadingDivChatBox" id="loadingDivChatBox{{user_id}}"><center>{{text_file_being_uploaded}}</center><center><div class="modalChatBox"></div></center></div></div></div>';Mustache.parse(d);var e={user_id:a,new_messages_count:0,display_name:b,new_messages_count_visibility:"hidden",send_button_url:liveChat.settings.floatingChatSendButtonUrl,box_position:liveChat.api.getFloatingBoxPosition(),text_user_is_writing:Mustache.render(liveChat.settings.texts.userIsWriting,{display_name:b}),text_write_message_here:liveChat.settings.texts.writeMessageHer,text_file_being_uploaded:liveChat.settings.fileBeingUploaded,image:c?c:liveChat.settings.defaultAvatarUrl},f=Mustache.render(d,e);$("body").append(f),$floatingBox=$("#chatBox"+a).first(),liveChat.api.changeChatBoxPosition(),$floatingBox.removeClass("hidden"),$($floatingBox).data(e),$($floatingBox).find(".remove").data("user-id",a).click(function(){liveChat.api.closeChatBox(jQuery(this).data("user-id"))}),$($floatingBox).find(".floating-box-header").first().data("other-user-id",a).click(function(){var a=jQuery(this),b=a.parent();liveChat.api.toggleFloatingBoxVisibility(b);var c=b.find(".chatBoxMessages").first();c.length&&c.scrollTop(c.scrollHeight),b.removeClass("lineColorNewMessage"),liveChat.api.resetNewMessagesCountFromUser(b.data("other-user-id"))});var g=$($floatingBox).find(".chatBoxMessages").first();liveChat.api.addMessagesToBox(g,a,b,c,!0),liveChat.helpers.scrollToBottom(g);for(var h=0;7>h;h++)setTimeout(function(){liveChat.helpers.scrollToBottom(g)},200*h);g.data({user_id:a,display_name:b,image:c}).on("scroll",function(){var a=jQuery(this),b=a.data();if(0===a.scrollTop()){var c='<div class="spinner" id="spinnerBox'+b.user_id+'"> <div class="rect1"></div> <div class="rect2"></div> <div class="rect3"></div> <div class="rect4"></div> <div class="rect5"></div> </div>';a.prepend(c),liveChat.scrollsHeightBefore[b.user_id]=this.scrollHeight,liveChat.api.addMessagesToBox(this,b.user_id,b.display_name,b.image)}}),liveChat.textareaHandler(a,liveChat.settings.current_user_id,$floatingBox,!0),$($floatingBox).find(".send-message-trigger").first().click(function(){liveChat.api.startSendingMessage(jQuery(this).parent())}),liveChat.api.addFloatingBoxToCookie(a,b,c),liveChat.$body.trigger("liveChat.floatingChatRendered",[e])},displayNewMessagesNotification:function(){liveChat.api.data.getUnreadMessagesCount().done(function(a){parseInt(a)>0&&$.titleAlert(a>1?"("+a+") Nuevos mensajes":"("+a+") Nuevo mensaje")})},addFloatingBoxToCookie:function(a,b,c){var d=liveChat.helpers.getCookie("chatBoxes"),e=a+"&*&"+b+"&*&"+c;if(""===d||" "===d||void 0===d)liveChat.helpers.setCookie("chatBoxes",e,3e6);else{for(var f=0,g=d.split("&**&"),h=0;h<g.length;h++){var i=g[h].split("&*&");if(parseInt(i[0])==a){f=1;break}}0==f&&liveChat.helpers.setCookie("chatBoxes",liveChat.helpers.getCookie("chatBoxes")+"&**&"+e,3e6)}},getPreviouslyOpenedFloatingBoxes:function(){out=[];var a=liveChat.helpers.getCookie("chatBoxes");if(!a||!$.trim(a))return out;for(var b=a.split("&**&"),c=0;c<b.length;c++)out.push(b[c].split("&*&"));return out},openPreviouslyOpenedFloatingBoxes:function(){var a=liveChat.helpers.getQueryStringValue("chat_with");if(a)var b=[liveChat.api.getContactFromCache(a)];else{var c=liveChat.api.getPreviouslyOpenedFloatingBoxes(),b=[];$.each(c,function(a,c){b.push({id:c[0],display_name:c[1],image:c[2]})})}$.each(b,function(a,b){liveChat.api.openFloatingBox(b)})},changeChatBoxPosition:function(){for(var a=$(".chatBox"),b=0;b<a.length;b++){var c=b*liveChat.settings.floatingChatBoxWidth+10;$(a[b]).css("right","0px"===liveChat.$body.find("#chatOpen").css("right")?c:c+205+"px")}liveChat.$body.trigger("liveChat.floatingBoxesPositionsUpdated",[a])},acceptNewUserConnection:function(a){liveChat.api.data.isConnectedWith(a).done(function(b){if(parseInt(b)>0){liveChat.acceptedConnection(b);var c={my:liveChat.settings.current_user_id,to:b};liveChat.sockets.emit("okNewCon",c),liveChat.$body.trigger("liveChat.newUserConnectionAccepted",[a])}})},searchContacts:function(a,b,c){if("first_letter"===b)var d=liveChat.api.data.searchContactsByFirstLetter(a,c);else var d=liveChat.api.data.searchContacts(a,c);d.done(function(a){liveChat.api.renderContactsSearchResults(a,c)})},renderContactsSearchResults:function(a,b){$(".contacts-list").empty(),a.length<1?liveChat.api.noUserFound():liveChat.api.renderContacts(a,liveChat.$body.find(".contacts-list")),liveChat.$body.trigger("liveChat.contactsSearchResultsRendered",[a])},searchMessages:function(a,b,c,d){liveChat.helpers.setDateNow(),$(".messageBox").off(),liveChat.api.data.searchMessages(a,b,c,d).done(function(a){$(".messageBox").empty(),liveChat.searchMax=0,liveChat.searchNum=1;for(var e=0;e<a.length;e++)liveChat.searchMax++,a[e].user_sender==b?liveChat.api.renderMessage($(".messageBox"),c,d,a[e].message,a[e].m_time,b,!1,!1):liveChat.api.renderMessage($(".messageBox"),null,null,a[e].message,a[e].m_time,null,!1,!1);if(liveChat.searchMax>0){var f=$(".messageBox").find(".oneMessage"),g=$(f[0]).find("div");$(g[1]).addClass("searchDivYellow")}var h=$(".messageBox");h[0].scrollTop=0})},addMessagesToBox:function(a,b,c,d,e){liveChat.helpers.setDateNow(),liveChat.api.data.getMessagesWith(b,!0).done(function(f){$("#spinnerBox"+b).length&&$("#spinnerBox"+b).remove();for(var g=0;g<f.length;g++)f[g].user_sender==b?liveChat.api.renderMessage(a,c,d,f[g].message,f[g].m_time,b,!0,!1):liveChat.api.renderMessage(a,null,null,f[g].message,f[g].m_time,b,!0,!1);e&&$(a).scrollTop($(a).height()),liveChat.pages[b]++})},stopTittleAlert:function(){liveChat.api.data.getUnreadMessagesCount().done(function(a){0==parseInt(a)&&$.titleAlert("New message",{duration:1,stopOnFocus:!1})})}};
liveChat.api.data={connectWith:function(a){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=addFriend",data:{id:a},error:function(a,b,c){},success:function(a){}})},getUnreadMessagesCount:function(){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=unread_messages_count",data:{},error:function(a,b,c){},success:function(a){}})},isConnectedWith:function(a){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=check_user",data:{id:a},error:function(a,b,c){},success:function(a){}})},markAllMessagesAsReadFrom:function(a){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=read_messages",data:{id:a},error:function(a,b,c){},success:function(a){}.bind(this)})},searchContacts:function(a,b){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=search_users",data:{timeNow:liveChat.strDateTime,like:a},error:function(a,b,c){},success:function(a){}.bind(this)})},searchContactsByFirstLetter:function(a){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=search_users_one_letter",data:{timeNow:liveChat.strDateTime,like:a},error:function(a,b,c){},success:function(a){}.bind(this)})},searchMessages:function(a,b,c,d){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=search_messages",data:{user_id:b,timeNow:liveChat.strDateTime,search:a},error:function(a,b,c){},success:function(a){}.bind(this)})},updateLastOnline:function(){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=update_last_online",data:{}})},getMessagesWith:function(a,b){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=get_all_messages",data:{user_id:a,timeNow:liveChat.strDateTime,page:b?liveChat.pages[a]:liveChat.page}})},getUserLastOnline:function(a,b){$.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=get_user_last_online",data:{id:a,timeNow:liveChat.strDateTime},error:function(a,b,c){},success:function(a){var c;0>a&&(c=!1),c={full_time:a.m_time.slice(0,4)+"/"+a.m_time.slice(5,7)+"/"+a.m_time.slice(8,10)+" "+a.m_time.slice(11,16),friendly_time:liveChat.helpers.findDifLastOnline(a.m_time)},b(c)}.bind(this)})},getContacts:function(){return $.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=read_users",data:{timeNow:liveChat.strDateTime},error:function(a,b,c){},success:function(a){}})},saveMessage:function(a,b){$.ajax({type:"POST",dataType:"json",url:liveChat.settings.backendUrl+"?livechat_request=yes&endpoint=send_message",data:{to:a,message:b},error:function(a,b,c){},success:function(a){}})}};